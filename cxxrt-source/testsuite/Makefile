# -*-makefile-*- file: Makefile.in
# -------------------------------------------------------------------------- 
# Copyright (c) 2002 Dietmar Kuehl

# Permission is hereby granted, free of charge, to any person obtaining
# a copy of this software and associated documentation files (the
# "Software"), to deal in the Software without restriction, including
# without limitation the rights to use, copy, modify, merge, publish,
# distribute, sublicense, and/or sell copies of the Software, and to
# permit persons to whom the Software is furnished to do so, subject
# to the following conditions:

# The above copyright notice and this permission notice shall be included
# in all copies or substantial portions of the Software.

# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY
# KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
# WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
# LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
# WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
# -------------------------------------------------------------------------- 
# Author: Dietmar Kuehl <http://www.dietmar-kuehl.de/>
# Title:  The input file for the Makefile generation
# Version: $Id: Makefile.in,v 1.1.1.1 2002/06/05 01:02:39 dietmar_kuehl Exp $
# -------------------------------------------------------------------------- 

TOOL = cxxrt

prefix      = /usr/local
exec_prefix = ${prefix}
bindir      = ${exec_prefix}/bin

RUNTEST = runtest
RUNTESTFLAGS =
FLAGS_TO_PASS =



CXX      = g++
CC       = gcc
OBJEXT   = o
CPPFLAGS =  -I../include -I../include/sgi -Iinclude
WARN     = -W -Wall -pedantic -ansi -Wno-unused
CXXFLAGS = -g -O2 $(WARN) -fno-builtin -Wno-unused -ftemplate-depth-32 $(EXTRAINC) $(CPPFLAGS) $(EXTRA)
LDFLAGS  =  -L.. $(LDEXTRA)
LIBS     = -lcxxrt -lsupc++ -lm
EXTRAOBJ = 
LDLIBS   = $(EXTRAOBJ) $(LIBS)

srcdir = .


default: tst.$(OBJEXT) tst
all:	$(TOOL)_version

%.ii: %.cpp
	$(COMPILE.cc) $< -E | sed -e '/^#/d' | sed -e '/^$$/d' > $@
%.s: %.cpp
	$(COMPILE.cc) $< -S

%.$(OBJEXT): %.cpp
	$(RM) -f $(@:.$(OBJEXT)=.ti) $@
	$(COMPILE.cc) $< -o $@
tst: tst.$(OBJEXT)
	$(CC) -o $@ tst.$(OBJEXT) $(LDFLAGS) $(LDLIBS)

$(TOOL)_version: Makefile
	@echo 'Making a trivial "version" file...'
	@-$(RM) $(TOOL)_version
	@touch $(TOOL)_version
	@echo "#!/bin/sh" >> $(TOOL)_version
	@echo 'echo $(TOOL) Version 0.0' >> $(TOOL)_version
	@chmod a+x $(TOOL)_version

check:  all site.exp
	$(RUNTEST) $(RUNTESTFLAGS) $(FLAGS_TO_PASS) --tool $(TOOL) --srcdir $(srcdir)

site.exp: Makefile $(EXTRAOBJ)
	@echo "Making a new config file..."
	-@rm -f ./tmp0
	@touch site.exp
	-@mv site.exp site.bak
	@echo "## these variables are automatically generated by make ##" > ./tmp0
	@echo "# Do not edit here. If you whish to override these values" >> ./tmp0
	@echo "# add them to the last section" >> ./tmp0
	@echo "set tool $(TOOL)" >> ./tmp0
	@echo "set srcdir $(src_dir)" >> ./tmp0
	@echo "set objdir `pwd`" >> ./tmp0
	@echo "set CC $(CC)" >> ./tmp0
	@echo "set CXX $(CXX)" >> ./tmp0
	@echo "set CPPFLAGS \"$(CPPFLAGS)\"" >> ./tmp0
	@echo "set CXXFLAGS \"$(CXXFLAGS)\"" >> ./tmp0
	@echo "set LDFLAGS \"$(LDFLAGS)\"" >> ./tmp0
	@echo "set LIBS \"$(LIBS)\"" >> ./tmp0
	@echo "set PRE \"$(PRE)\"" >> ./tmp0
	@echo "set POST \"$(POST)\"" >> ./tmp0
	@echo "## All variables above are generated by configure. Do Not Edit ##" >> ./tmp0
	@cat ./tmp0 > site.exp
	@sed < site.bak -e '1,/^## All variables above.*##/d' >> site.exp
	@rm -f ./tmp0

# dummy targets:
install:
depend:

# clean up targets:
clean:
	$(RM) *~ core *.info*
	$(RM) lt*.cpp bug
	$(RM) mkerr olderr $(TOOL).log $(TOOL).sum
	$(RM) site.bak

distclean: clean
	$(RM) site.exp $(TOOL)_version
	$(RM) Makefile config.cache config.log config.status

make.depend depend:
	$(CXX) $(CPPFLAGS) -M tst.cpp > make.depend

include make.depend
